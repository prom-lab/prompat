<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PromPat - نظام المكافآت المتقدم</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2E86AB;
            --secondary: #A23B72;
            --accent: #F18F01;
            --success: #4CB944;
            --warning: #F25F5C;
            --dark: #1A1A2E;
            --light: #F8F9FA;
            --gray: #6C757D;
            --gradient: linear-gradient(135deg, #2E86AB 0%, #A23B72 100%);
            --card-shadow: 0 10px 30px rgba(0,0,0,0.1);
            --hover-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1A1A2E 0%, #16213E 100%);
            color: var(--light);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 25px;
        }
        
        /* الهيدر المحسن */
        header {
            background: var(--dark);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            grid-column: 1 / -1;
            box-shadow: var(--card-shadow);
            border: 1px solid rgba(255,255,255,0.1);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient);
        }
        
        .nav-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .logo {
            font-size: 2.5rem;
            font-weight: 800;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i {
            font-size: 2.8rem;
        }
        
        .home-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .home-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(46, 134, 171, 0.4);
        }
        
        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 15px;
            margin-top: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .user-rank {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .rank-badge {
            background: var(--gradient);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .points-display {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* شريط التقدم */
        .progress-section {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .progress-bar {
            height: 12px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress {
            height: 100%;
            background: var(--gradient);
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        /* التنقل */
        .nav-tabs {
            display: flex;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 25px;
            grid-column: 1 / -1;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .nav-tab {
            flex: 1;
            text-align: center;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .nav-tab.active {
            border-bottom: 3px solid var(--accent);
            background: rgba(255,255,255,0.1);
            color: var(--accent);
        }
        
        .nav-tab:hover {
            background: rgba(255,255,255,0.08);
        }
        
        /* المحتوى الرئيسي */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .tab-content {
            display: none;
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-title {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: var(--accent);
            border-bottom: 2px solid rgba(255,255,255,0.1);
            padding-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        /* الكروت */
        .card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.3s;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
        }
        
        /* الأزرار */
        .btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(46, 134, 171, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #4CB944 0%, #2E8B57 100%);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #F25F5C 0%, #DC143C 100%);
        }
        
        /* الشريط الجانبي */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .sidebar-widget {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--card-shadow);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        /* الإعلانات */
        .ad-container {
            background: rgba(255,255,255,0.08);
            border: 2px dashed rgba(255,255,255,0.2);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: all 0.3s;
        }
        
        .ad-container:hover {
            border-color: var(--accent);
        }
        
        .inline-ad {
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .inline-ad:hover {
            transform: translateY(-2px);
            border-color: var(--accent);
        }
        
        /* النوافذ المنبثقة */
        .popup-ad-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 3000;
            justify-content: center;
            align-items: center;
        }
        
        .popup-ad-content {
            background: var(--dark);
            border-radius: 20px;
            width: 95%;
            max-width: 900px;
            height: 85vh;
            padding: 0;
            position: relative;
            display: flex;
            flex-direction: column;
            border: 2px solid var(--accent);
            box-shadow: 0 25px 50px rgba(0,0,0,0.5);
        }
        
        .popup-ad-header {
            background: var(--gradient);
            padding: 20px;
            border-radius: 18px 18px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .popup-ad-close {
            background: rgba(0,0,0,0.3);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s;
        }
        
        .popup-ad-close:hover {
            background: rgba(0,0,0,0.5);
            transform: rotate(90deg);
        }
        
        .popup-ad-body {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow: hidden;
        }
        
        .ad-counter {
            background: var(--accent);
            color: var(--dark);
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* نظام المشاركة */
        .share-system {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .share-link-container {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        
        .share-link-input {
            flex: 1;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: white;
            font-size: 14px;
        }
        
        .social-share-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .social-share-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.2rem;
        }
        
        .social-share-btn.facebook { background: #3b5998; }
        .social-share-btn.whatsapp { background: #25D366; }
        .social-share-btn.telegram { background: #0088cc; }
        .social-share-btn.twitter { background: #1DA1F2; }
        
        .social-share-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
        
        .share-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .share-stat-card {
            background: rgba(255,255,255,0.03);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .share-stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 5px;
        }
        
        .share-stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        /* نظام الرتب */
        .rank-system {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .rank-card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .rank-card.active {
            border-color: var(--accent);
            background: rgba(241, 143, 1, 0.1);
        }
        
        .rank-card.locked {
            opacity: 0.6;
            filter: grayscale(0.5);
        }
        
        .rank-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--accent);
        }
        
        /* الإشعارات */
        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            background: var(--dark);
            padding: 20px 25px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border-right: 4px solid var(--success);
            z-index: 1001;
            transform: translateX(150%);
            transition: transform 0.3s ease;
            max-width: 400px;
            border: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            border-right-color: var(--warning);
        }
        
        /* الإحصائيات */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        /* التجاوب */
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                grid-row: 3;
            }
        }
        
        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
            }
            
            .user-info {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .rank-system {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- منطقة الإشعارات -->
    <div id="notificationArea"></div>

    <!-- النافذة المنبثقة الأولى (السمارت لينك) -->
    <div id="smartLinkModal" class="popup-ad-modal">
        <div class="popup-ad-content">
            <div class="popup-ad-header">
                <h3 style="color: white; margin: 0;"><i class="fas fa-gift"></i> عرض خاص لك!</h3>
                <button class="popup-ad-close" id="closeSmartLink">✕</button>
            </div>
            <div class="popup-ad-body">
                <div class="ad-counter">
                    <i class="fas fa-star"></i>
                    <span>عرض حصري - اضغط على الرابط بالأسفل</span>
                </div>
                <div style="width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                    <h3 style="color: var(--accent); margin-bottom: 20px; text-align: center;">اكتشف هذا العرض المميز!</h3>
                    <a href="https://www.effectivegatecpm.com/cjuuc452dt?key=132d2f74f4fe375423ba8227b117e27d" 
                       target="_blank" 
                       style="background: var(--gradient); color: white; padding: 20px 40px; border-radius: 50px; text-decoration: none; font-size: 1.2rem; font-weight: bold; display: flex; align-items: center; gap: 15px; transition: all 0.3s;"
                       onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 15px 30px rgba(46, 134, 171, 0.4)';"
                       onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none';">
                        <i class="fas fa-external-link-alt"></i>
                        اضغط هنا لاكتشاف العرض
                    </a>
                    <p style="margin-top: 20px; color: var(--gray); text-align: center; max-width: 500px;">
                        ستحصل على مكافأة خاصة عند تفعيل هذا العرض! لا تفوت هذه الفرصة الفريدة.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- النافذة المنبثقة الثانية (إعلانات Adsterra) -->
    <div id="adsterraModal" class="popup-ad-modal">
        <div class="popup-ad-content">
            <div class="popup-ad-header">
                <h3 style="color: white; margin: 0;"><i class="fas fa-ad"></i> شاهد هذا الإعلان</h3>
                <button class="popup-ad-close" id="closeAdsterra">✕</button>
            </div>
            <div class="popup-ad-body">
                <div class="ad-counter" id="adTimer">
                    <i class="fas fa-clock"></i>
                    <span>سيغلق الإعلان خلال: <span id="countdown">5</span> ثانية</span>
                </div>
                <div id="adsterraAdContainer" style="width: 100%; height: 100%; display: flex; justify-content: center; align-items: center;">
                    <!-- سيتم تحميل إعلان Adsterra هنا -->
                </div>
            </div>
        </div>
    </div>

    <!-- شاشة تسجيل الدخول -->
    <div id="loginScreen" style="display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px;">
        <div style="background: rgba(255,255,255,0.05); padding: 40px; border-radius: 20px; max-width: 400px; width: 100%; border: 1px solid rgba(255,255,255,0.1);">
            <h2 style="text-align: center; margin-bottom: 30px; color: var(--accent);">تسجيل الدخول</h2>
            <form id="loginForm">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; color: var(--gray);">البريد الإلكتروني</label>
                    <input type="email" id="loginEmail" required style="width: 100%; padding: 15px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; color: var(--gray);">كلمة المرور</label>
                    <input type="password" id="loginPassword" required style="width: 100%; padding: 15px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
                </div>
                <button type="submit" class="btn" style="width: 100%;">
                    <i class="fas fa-sign-in-alt"></i>
                    تسجيل الدخول
                </button>
            </form>
            <p style="text-align: center; margin-top: 20px; color: var(--gray);">
                ليس لديك حساب؟ 
                <a href="#" id="showRegister" style="color: var(--accent); text-decoration: none;">إنشاء حساب</a>
            </p>
        </div>
    </div>

    <!-- شاشة إنشاء حساب -->
    <div id="registerScreen" style="display: none; justify-content: center; align-items: center; min-height: 100vh; padding: 20px;">
        <div style="background: rgba(255,255,255,0.05); padding: 40px; border-radius: 20px; max-width: 400px; width: 100%; border: 1px solid rgba(255,255,255,0.1);">
            <h2 style="text-align: center; margin-bottom: 30px; color: var(--accent);">إنشاء حساب جديد</h2>
            <form id="registerForm">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; color: var(--gray);">الاسم الكامل</label>
                    <input type="text" id="registerName" required style="width: 100%; padding: 15px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; color: var(--gray);">البريد الإلكتروني</label>
                    <input type="email" id="registerEmail" required style="width: 100%; padding: 15px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; color: var(--gray);">كلمة المرور</label>
                    <input type="password" id="registerPassword" required style="width: 100%; padding: 15px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
                </div>
                <button type="submit" class="btn" style="width: 100%;">
                    <i class="fas fa-user-plus"></i>
                    إنشاء حساب
                </button>
            </form>
            <p style="text-align: center; margin-top: 20px; color: var(--gray);">
                لديك حساب بالفعل؟ 
                <a href="#" id="showLogin" style="color: var(--accent); text-decoration: none;">تسجيل الدخول</a>
            </p>
        </div>
    </div>

    <!-- التطبيق الرئيسي -->
    <div id="app" style="display: none;">
        <div class="container">
            <header>
                <div class="nav-bar">
                    <div class="logo">
                        <i class="fas fa-crown"></i>
                        PromPat
                    </div>
                    <a href="index.html" class="home-btn">
                        <i class="fas fa-home"></i>
                        الصفحة الرئيسية
                    </a>
                </div>
                <p style="color: var(--gray); font-size: 1.1rem;">اكسب النقاط وتقدم في الرتب واستبدل بمكافآت حقيقية!</p>
                
                <div class="user-info">
                    <div>
                        <div style="font-size: 1.2rem; margin-bottom: 5px;">مرحباً، <span id="userName" style="color: var(--accent);">مستخدم</span></div>
                        <div class="user-rank">
                            <div class="rank-badge">
                                <i class="fas fa-medal"></i>
                                <span id="currentRank">مبتدئ</span>
                            </div>
                            <div style="color: var(--gray); font-size: 0.9rem;">
                                <span id="adsWatched">0</span> إعلان | <span id="pointsEarned">0</span> نقطة
                            </div>
                        </div>
                    </div>
                    <div class="points-display">
                        <i class="fas fa-coins"></i>
                        <span id="userPoints">0</span> نقطة
                    </div>
                </div>

                <!-- شريط التقدم نحو الهدف -->
                <div class="progress-section">
                    <div class="progress-header">
                        <div>
                            <h4 style="color: var(--accent); margin-bottom: 5px;">تقدمك نحو الهدف</h4>
                            <p style="color: var(--gray); font-size: 0.9rem;">الهدف الأول: 200 نقطة</p>
                        </div>
                        <div style="color: var(--accent); font-weight: bold;">
                            <span id="progressPercent">0%</span>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress" id="mainProgress" style="width: 0%"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; color: var(--gray); font-size: 0.9rem;">
                        <span>0 نقطة</span>
                        <span>200 نقطة</span>
                    </div>
                </div>
            </header>

            <div class="nav-tabs">
                <div class="nav-tab active" data-tab="earn">
                    <i class="fas fa-coins"></i>
                    ربح النقاط
                </div>
                <div class="nav-tab" data-tab="redeem">
                    <i class="fas fa-gift"></i>
                    مركز الاسترداد
                </div>
                <div class="nav-tab" data-tab="stats">
                    <i class="fas fa-chart-line"></i>
                    الإحصائيات
                </div>
                <div class="nav-tab" data-tab="ranks">
                    <i class="fas fa-trophy"></i>
                    نظام الرتب
                </div>
                <div class="nav-tab" data-tab="history">
                    <i class="fas fa-history"></i>
                    سجل النشاط
                </div>
            </div>

            <!-- المحتوى الرئيسي -->
            <div class="main-content">
                <!-- قسم ربح النقاط -->
                <div id="earn" class="tab-content active">
                    <h2 class="section-title">
                        <i class="fas fa-coins"></i>
                        طرق ربح النقاط
                    </h2>
                    
                    <!-- إعلان البانر الأول -->
                    <div class="ad-container">
                        <h4 style="color: var(--accent); margin-bottom: 15px;">إعلان مميز</h4>
                        <div id="bannerAd1">
                            <!-- سيتم تحميل إعلان البانر الأول هنا -->
                        </div>
                    </div>

                    <!-- نظام المشاركة المحسن -->
                    <div class="share-system">
                        <h4 style="color: var(--accent); margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-share-alt"></i>
                            نظام المشاركة - احصل على 2 نقاط لكل نقرة
                        </h4>
                        <p style="margin-bottom: 20px; color: var(--gray); text-align: center;">
                            شارك رابطك الخاص واحصل على <strong style="color: var(--accent);">2 نقاط</strong> لكل شخص ينقر على رابطك!<br>
                            <small style="color: var(--warning);">الحد اليومي: 20 نقرة (40 نقطة كحد أقصى يومياً)</small>
                        </p>
                        
                        <!-- إحصائيات المشاركة -->
                        <div class="share-stats">
                            <div class="share-stat-card">
                                <div class="share-stat-value" id="totalShares">0</div>
                                <div class="share-stat-label">إجمالي المشاركات</div>
                            </div>
                            <div class="share-stat-card">
                                <div class="share-stat-value" id="totalClicks">0</div>
                                <div class="share-stat-label">النقرات على الرابط</div>
                            </div>
                            <div class="share-stat-card">
                                <div class="share-stat-value" id="todayClicks">0/20</div>
                                <div class="share-stat-label">النقرات اليوم</div>
                            </div>
                            <div class="share-stat-card">
                                <div class="share-stat-value" id="pointsFromShares">0</div>
                                <div class="share-stat-label">النقاط من المشاركة</div>
                            </div>
                        </div>
                        
                        <!-- رابط المشاركة -->
                        <div class="share-link-container">
                            <input type="text" id="shareUrl" class="share-link-input" readonly>
                            <button class="btn" id="copyLink">
                                <i class="fas fa-copy"></i>
                                نسخ الرابط
                            </button>
                        </div>
                        
                        <!-- أزرار المشاركة -->
                        <div class="social-share-buttons">
                            <div class="social-share-btn facebook" id="shareFacebook">
                                <i class="fab fa-facebook-f"></i>
                            </div>
                            <div class="social-share-btn whatsapp" id="shareWhatsapp">
                                <i class="fab fa-whatsapp"></i>
                            </div>
                            <div class="social-share-btn telegram" id="shareTelegram">
                                <i class="fab fa-telegram-plane"></i>
                            </div>
                            <div class="social-share-btn twitter" id="shareTwitter">
                                <i class="fab fa-twitter"></i>
                            </div>
                        </div>
                    </div>

                    <!-- إعلان البانر الثاني -->
                    <div class="ad-container">
                        <h4 style="color: var(--accent); margin-bottom: 15px;">عروض خاصة</h4>
                        <div id="bannerAd2">
                            <!-- سيتم تحميل إعلان البانر الثاني هنا -->
                        </div>
                    </div>

                    <!-- البقاء في الموقع -->
                    <div class="card">
                        <h4 style="color: var(--accent); margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-clock"></i>
                            البقاء في الموقع (4 نقاط كل 80 ثانية)
                        </h4>
                        <p style="margin-bottom: 20px; color: var(--gray);">
                            احصل على 4 نقاط كل 80 ثانية تقضيها في الموقع!
                        </p>
                        <div class="progress-bar">
                            <div class="progress" id="timeProgress" style="width: 0%"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 10px; color: var(--gray); font-size: 0.9rem;">
                            <span>0 ثانية</span>
                            <span>80 ثانية</span>
                        </div>
                        <div style="text-align: center; margin-top: 10px;">
                            <span id="sessionTime">0</span> ثانية في هذه الجلسة
                        </div>
                    </div>

                    <!-- إعلان داخلي -->
                    <div class="inline-ad" id="inlineAd1">
                        <h4 style="color: var(--accent);">اكتشف العروض الحصرية!</h4>
                    </div>

                    <!-- أكواد الدعوة -->
                    <div class="card">
                        <h4 style="color: var(--accent); margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-ticket-alt"></i>
                            أكواد الدعوة
                        </h4>
                        <p style="margin-bottom: 20px; color: var(--gray);">أدخل كود الدعوة للحصول على مكافأة فورية</p>
                        
                        <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                            <input type="text" id="promoCode" class="share-link-input" placeholder="أدخل الكود هنا">
                            <button class="btn" id="applyCode">
                                <i class="fas fa-check"></i>
                                تطبيق الكود
                            </button>
                        </div>
                    </div>
                </div>

                <!-- قسم الاسترداد -->
                <div id="redeem" class="tab-content">
                    <h2 class="section-title">
                        <i class="fas fa-gift"></i>
                        استبدل نقاطك
                    </h2>
                    
                    <!-- إعلان داخل قسم الاسترداد -->
                    <div class="inline-ad" id="redeemAd">
                        <h4 style="color: var(--accent);">عرض خاص في قسم الاسترداد!</h4>
                    </div>
                    
                    <div class="reward-item" style="background: rgba(255,255,255,0.05); padding: 25px; border-radius: 15px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                        <div class="reward-details">
                            <h4 style="color: var(--accent); margin-bottom: 10px;">20 جنيه مصري</h4>
                            <p style="color: var(--gray);">استبدل 200 نقطة للحصول على 20 جنيه</p>
                        </div>
                        <div class="reward-points" style="color: var(--accent); font-weight: bold; margin-left: 20px;">200 نقطة</div>
                        <button class="btn btn-success redeem-btn" data-amount="20" data-points="200">
                            <i class="fas fa-exchange-alt"></i>
                            استبدال
                        </button>
                    </div>
                    
                    <div class="reward-item" style="background: rgba(255,255,255,0.05); padding: 25px; border-radius: 15px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                        <div class="reward-details">
                            <h4 style="color: var(--accent); margin-bottom: 10px;">50 جنيه مصري</h4>
                            <p style="color: var(--gray);">استبدل 500 نقطة للحصول على 50 جنيه</p>
                        </div>
                        <div class="reward-points" style="color: var(--accent); font-weight: bold; margin-left: 20px;">500 نقطة</div>
                        <button class="btn btn-success redeem-btn" data-amount="50" data-points="500">
                            <i class="fas fa-exchange-alt"></i>
                            استبدال
                        </button>
                    </div>
                </div>

                <!-- قسم الإحصائيات -->
                <div id="stats" class="tab-content">
                    <h2 class="section-title">
                        <i class="fas fa-chart-line"></i>
                        إحصائياتك الشخصية
                    </h2>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="totalPoints">0</div>
                            <div class="stat-label">إجمالي النقاط</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalAds">0</div>
                            <div class="stat-label">إجمالي الإعلانات</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="todayPoints">0</div>
                            <div class="stat-label">نقاط اليوم</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="todayAds">0</div>
                            <div class="stat-label">إعلانات اليوم</div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h4 style="color: var(--accent); margin-bottom: 20px;">تقدمك الشهري</h4>
                        <div style="height: 200px; background: rgba(255,255,255,0.03); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: var(--gray);">
                            رسم بياني سيظهر هنا قريباً...
                        </div>
                    </div>
                </div>

                <!-- قسم نظام الرتب -->
                <div id="ranks" class="tab-content">
                    <h2 class="section-title">
                        <i class="fas fa-trophy"></i>
                        نظام الرتب والتقدم
                    </h2>
                    
                    <div class="rank-system">
                        <div class="rank-card active">
                            <div class="rank-icon">
                                <i class="fas fa-seedling"></i>
                            </div>
                            <div class="rank-name">مبتدئ ناشئ</div>
                            <div class="rank-requirements">0-60 إعلان | 0-200 نقطة</div>
                            <div style="color: var(--success); font-weight: bold;">مستواك الحالي</div>
                        </div>
                        
                        <div class="rank-card locked">
                            <div class="rank-icon">
                                <i class="fas fa-rocket"></i>
                            </div>
                            <div class="rank-name">متوسط الاستخدام</div>
                            <div class="rank-requirements">61-140 إعلان | 201-500 نقطة</div>
                            <div style="color: var(--gray);">تحتاج 61 إعلان و 201 نقطة</div>
                        </div>
                        
                        <div class="rank-card locked">
                            <div class="rank-icon">
                                <i class="fas fa-crown"></i>
                            </div>
                            <div class="rank-name">مبدع رقمي</div>
                            <div class="rank-requirements">141+ إعلان | 501+ نقطة</div>
                            <div style="color: var(--gray);">تحتاج 141 إعلان و 501 نقطة</div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h4 style="color: var(--accent); margin-bottom: 15px;">تقدمك في الرتب</h4>
                        <div class="progress-bar">
                            <div class="progress" id="rankProgress" style="width: 25%"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 10px; color: var(--gray);">
                            <span>مبتدئ ناشئ</span>
                            <span>25%</span>
                            <span>متوسط الاستخدام</span>
                        </div>
                    </div>
                </div>

                <!-- قسم سجل النشاط -->
                <div id="history" class="tab-content">
                    <h2 class="section-title">
                        <i class="fas fa-history"></i>
                        سجل النشاط
                    </h2>
                    <div id="activityLog">
                        <!-- سيتم ملء سجل النشاط ديناميكياً -->
                    </div>
                </div>
            </div>

            <!-- الشريط الجانبي -->
            <div class="sidebar">
                <!-- إعلان البانر في الشريط الجانبي -->
                <div class="sidebar-widget">
                    <h4 style="color: var(--accent); margin-bottom: 15px; text-align: center;">إعلان مميز</h4>
                    <div id="sidebarAd">
                        <!-- سيتم تحميل إعلان البانر هنا -->
                    </div>
                </div>
                
                <!-- إحصائيات سريعة -->
                <div class="sidebar-widget">
                    <h4 style="color: var(--accent); margin-bottom: 20px; text-align: center;">إحصائيات سريعة</h4>
                    <div style="display: flex; flex-direction: column; gap: 15px;">
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--gray);">النقرات اليوم:</span>
                            <span style="color: var(--accent); font-weight: bold;" id="sidebarTodayClicks">0/20</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--gray);">النقاط اليوم:</span>
                            <span style="color: var(--accent); font-weight: bold;" id="sidebarTodayPoints">0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--gray);">الرتبة التالية:</span>
                            <span style="color: var(--accent); font-weight: bold;">61 إعلان</span>
                        </div>
                    </div>
                </div>
                
                <!-- إعلان آخر -->
                <div class="sidebar-widget">
                    <h4 style="color: var(--accent); margin-bottom: 15px; text-align: center;">عروض حصرية</h4>
                    <div class="inline-ad" id="sidebarAd2">
                        <span style="color: var(--accent);">اكتشف العروض!</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
        // تكوين Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCffrRr-wYBeiAf7GML6Xs3kQg-14mLFhQ",
            authDomain: "prompat-76c51.firebaseapp.com",
            projectId: "prompat-76c51",
            storageBucket: "prompat-76c51.firebasestorage.app",
            messagingSenderId: "663109200073",
            appId: "1:663109200073:web:9da9a15649a88028b68518",
            measurementId: "G-HKL1XTBX6H"
        };

        // تهيئة Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // بيانات التطبيق
        let currentUser = null;
        let userData = {
            name: "",
            email: "",
            points: 0,
            totalPoints: 0,
            adsWatched: 0,
            totalAds: 0,
            todayAds: 0,
            todayPoints: 0,
            shares: 0,
            shareClicks: 0,
            todayShareClicks: 0,
            pointsFromShares: 0,
            buttonClicks: 0,
            rank: "مبتدئ ناشئ",
            activity: [],
            usedPromoCodes: [],
            lastAdDate: null,
            lastButtonClickDate: null,
            referralCode: "",
            referredBy: "",
            lastClickDate: null
        };

        // متغيرات النظام
        let buttonClickCount = 0;
        let sessionTime = 0;
        let timePointsInterval;
        let adInterval;
        const dailyClickLimit = 20;
        const pointsPerClick = 2;
        const timePointsIntervalMs = 80000; // 80 ثانية
        const pointsPerTime = 4;
        const autoAdInterval = 30000; // 30 ثانية

        // رابط الموقع الأساسي
        const WEBSITE_URL = window.location.origin + window.location.pathname;

        // DOM جاهز
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        // تهيئة التطبيق
        function initializeApp() {
            setupEventListeners();
            checkAuthState();
            checkReferral();
            loadAllAds();
            startTimeTracking();
            startAutoAdSystem();
        }

        // بدء تتبع الوقت
        function startTimeTracking() {
            setInterval(() => {
                sessionTime++;
                document.getElementById('sessionTime').textContent = sessionTime;
                
                // تحديث شريط التقدم
                const progress = (sessionTime % 80) / 80 * 100;
                document.getElementById('timeProgress').style.width = `${progress}%`;
                
                // منح النقاط كل 80 ثانية
                if (sessionTime > 0 && sessionTime % 80 === 0) {
                    addPoints(pointsPerTime, 'البقاء في الموقع');
                    showNotification(`حصلت على ${pointsPerTime} نقاط للبقاء في الموقع!`, 'success');
                }
            }, 1000);
        }

        // بدء نظام الإعلانات التلقائي
        function startAutoAdSystem() {
            adInterval = setInterval(() => {
                if (currentUser) {
                    showAdsterraAd();
                }
            }, autoAdInterval);
        }

        // تحميل جميع الإعلانات
        function loadAllAds() {
            // إعلانات البانر
            loadBannerAd('bannerAd1');
            loadBannerAd('bannerAd2');
            loadBannerAd('sidebarAd');
            
            // إعلانات داخلية
            loadInlineAd('inlineAd1');
            loadInlineAd('sidebarAd2');
            loadInlineAd('redeemAd');
        }

        // تحميل إعلان بانر
        function loadBannerAd(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            try {
                const script = document.createElement('script');
                script.type = 'text/javascript';
                script.innerHTML = `
                    atOptions = {
                        'key' : '1333b27d45848599574868956a16a6ee',
                        'format' : 'iframe',
                        'height' : 300,
                        'width' : 160,
                        'params' : {}
                    };
                `;
                container.appendChild(script);
                
                const invokeScript = document.createElement('script');
                invokeScript.type = 'text/javascript';
                invokeScript.src = '//www.highperformanceformat.com/1333b27d45848599574868956a16a6ee/invoke.js';
                container.appendChild(invokeScript);
            } catch (error) {
                console.log('Error loading banner ad:', error);
                loadBackupAd(container);
            }
        }

        // تحميل إعلان داخلي
        function loadInlineAd(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            try {
                const script = document.createElement('script');
                script.type = 'text/javascript';
                script.src = '//pl27889305.effectivegatecpm.com/20/6e/b3/206eb3375690b9e257ae349679b7db23.js';
                container.appendChild(script);
            } catch (error) {
                console.log('Error loading inline ad:', error);
                loadBackupAd(container);
            }
        }

        // تحميل إعلان احتياطي
        function loadBackupAd(container) {
            const backupAds = [
                {
                    title: "عروض خاصة!",
                    description: "احصل على خصم 20% على أول طلب لك",
                    buttonText: "اطلع الآن"
                }
            ];
            
            const randomAd = backupAds[Math.floor(Math.random() * backupAds.length)];
            container.innerHTML = `
                <div style="text-align: center; width: 100%; padding: 20px;">
                    <h4 style="color: var(--accent); margin-bottom: 10px;">${randomAd.title}</h4>
                    <p style="color: var(--gray); margin-bottom: 15px;">${randomAd.description}</p>
                    <button class="btn" style="background: var(--accent);">${randomAd.buttonText}</button>
                </div>
            `;
        }

        // عرض إعلان Adsterra في النافذة المنبثقة
        function showAdsterraAd() {
            if (!currentUser) return;

            document.getElementById('adsterraModal').style.display = 'flex';
            
            // تحميل إعلان Adsterra
            const adContainer = document.getElementById('adsterraAdContainer');
            adContainer.innerHTML = `
                <div id="container-50691a36ff5f5b69c33f81398fc8214d"></div>
            `;
            
            try {
                const script = document.createElement('script');
                script.async = true;
                script.setAttribute('data-cfasync', 'false');
                script.src = '//pl27889328.effectivegatecpm.com/50691a36ff5f5b69c33f81398fc8214d/invoke.js';
                adContainer.appendChild(script);
            } catch (error) {
                console.log('Error loading adsterra ad:', error);
                loadBackupAd(adContainer);
            }
            
            // بدء العد التنازلي (5 ثواني)
            let countdown = 5;
            const countdownElement = document.getElementById('countdown');
            countdownElement.textContent = countdown;
            
            const countdownInterval = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    document.getElementById('adsterraModal').style.display = 'none';
                    
                    // إضافة النقاط
                    addPoints(1, 'مشاهدة إعلان تلقائي');
                    userData.adsWatched++;
                    userData.totalAds++;
                    
                    showNotification('تمت مشاهدة الإعلان بنجاح! حصلت على 1 نقطة.', 'success');
                }
            }, 1000);
        }

        // التحقق من رابط الإحالة
        function checkReferral() {
            const urlParams = new URLSearchParams(window.location.search);
            const refCode = urlParams.get('ref');
            
            if (refCode) {
                // تأخير معالجة الإحالة لضمان تحميل بيانات المستخدم
                setTimeout(() => {
                    if (currentUser) {
                        handleReferralClick(refCode);
                    } else {
                        // إذا لم يكن المستخدم مسجلاً، نحفظ الكود لاستخدامه لاحقاً
                        localStorage.setItem('pendingReferral', refCode);
                    }
                }, 2000);
            }
        }

        // إعداد مستمعي الأحداث
        function setupEventListeners() {
            // التنقل بين الأقسام
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    this.classList.add('active');
                    document.getElementById(this.dataset.tab).classList.add('active');
                });
            });

            // نسخ رابط المشاركة
            document.getElementById('copyLink').addEventListener('click', function() {
                const shareUrl = document.getElementById('shareUrl');
                shareUrl.select();
                document.execCommand('copy');
                showNotification('تم نسخ الرابط بنجاح!', 'success');
            });

            // مشاركة على وسائل التواصل
            document.getElementById('shareFacebook').addEventListener('click', function() {
                shareOnSocialMedia('facebook');
            });

            document.getElementById('shareWhatsapp').addEventListener('click', function() {
                shareOnSocialMedia('whatsapp');
            });

            document.getElementById('shareTwitter').addEventListener('click', function() {
                shareOnSocialMedia('twitter');
            });

            document.getElementById('shareTelegram').addEventListener('click', function() {
                shareOnSocialMedia('telegram');
            });

            // تطبيق كود الدعوة
            document.getElementById('applyCode').addEventListener('click', function() {
                const code = document.getElementById('promoCode').value.trim().toUpperCase();
                applyPromoCode(code);
            });

            // استبدال النقاط
            document.querySelectorAll('.redeem-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const points = parseInt(this.dataset.points);
                    const amount = parseInt(this.dataset.amount);
                    
                    if (userData.points >= points) {
                        userData.points -= points;
                        updatePointsDisplay();
                        updateStats();
                        saveUserData();
                        
                        showNotification(`تم استبدال ${points} نقطة ب ${amount} جنيه بنجاح!`, 'success');
                    } else {
                        showNotification('نقاطك غير كافية لهذا الاسترداد!', 'error');
                    }
                });
            });

            // إغلاق النوافذ المنبثقة
            document.getElementById('closeSmartLink').addEventListener('click', function() {
                document.getElementById('smartLinkModal').style.display = 'none';
            });

            document.getElementById('closeAdsterra').addEventListener('click', function() {
                document.getElementById('adsterraModal').style.display = 'none';
            });

            // تسجيل الدخول وإنشاء حساب
            document.getElementById('showRegister').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('registerScreen').style.display = 'flex';
            });

            document.getElementById('showLogin').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('registerScreen').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'flex';
            });

            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                loginUser(email, password);
            });

            document.getElementById('registerForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const name = document.getElementById('registerName').value;
                const email = document.getElementById('registerEmail').value;
                const password = document.getElementById('registerPassword').value;
                registerUser(name, email, password);
            });

            // تتبع النقرات على الأزرار (لنافذة السمارت لينك)
            document.addEventListener('click', function(e) {
                if (e.target.closest('.btn') || e.target.closest('.nav-tab') || e.target.closest('.social-share-btn')) {
                    handleButtonClick();
                }
            });

            // تتبع النقرات على الإعلانات الداخلية
            document.querySelectorAll('.inline-ad').forEach(ad => {
                ad.addEventListener('click', function() {
                    handleAdClick();
                });
            });
        }

        // مشاركة على وسائل التواصل الاجتماعي
        function shareOnSocialMedia(platform) {
            const shareUrl = document.getElementById('shareUrl').value;
            const text = encodeURIComponent('اكتشف هذا الموقع الرائع واحصل على مكافآت حقيقية! اربح النقاط واستبدلها بمكافآت.');
            
            let shareUrlFull = '';
            
            switch(platform) {
                case 'facebook':
                    shareUrlFull = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}&quote=${text}`;
                    break;
                case 'whatsapp':
                    shareUrlFull = `https://wa.me/?text=${text}%20${encodeURIComponent(shareUrl)}`;
                    break;
                case 'twitter':
                    shareUrlFull = `https://twitter.com/intent/tweet?text=${text}&url=${encodeURIComponent(shareUrl)}`;
                    break;
                case 'telegram':
                    shareUrlFull = `https://t.me/share/url?url=${encodeURIComponent(shareUrl)}&text=${text}`;
                    break;
            }
            
            window.open(shareUrlFull, '_blank', 'width=600,height=400');
            
            // تتبع المشاركة
            trackShare(platform);
        }

        // تتبع النقرات على الأزرار
        function handleButtonClick() {
            buttonClickCount++;
            
            // إذا وصل إلى 5 نقرات، عرض نافذة السمارت لينك
            if (buttonClickCount >= 5) {
                showSmartLinkModal();
                buttonClickCount = 0;
            }
        }

        // تتبع النقرات على الإعلانات
        function handleAdClick() {
            addPoints(1, 'نقرة على إعلان');
            showNotification('تم احتساب نقطة لنقرتك على الإعلان!', 'success');
        }

        // عرض نافذة السمارت لينك
        function showSmartLinkModal() {
            document.getElementById('smartLinkModal').style.display = 'flex';
            
            // إغلاق تلقائي بعد 5 ثواني
            setTimeout(() => {
                document.getElementById('smartLinkModal').style.display = 'none';
            }, 5000);
        }

        // تتبع المشاركة
        function trackShare(platform) {
            if (!currentUser) return;
            
            userData.shares++;
            updateShareStats();
            saveUserData();
            
            showNotification(`تم تسجيل مشاركتك على ${platform}`, 'success');
        }

        // معالجة نقرات الإحالة
        function handleReferralClick(referralCode) {
            if (!currentUser) return;
            
            // تجنب منح النقاط للمستخدم نفسه
            if (referralCode === userData.referralCode) {
                return;
            }
            
            const today = new Date().toDateString();
            if (userData.lastClickDate !== today) {
                userData.todayShareClicks = 0;
                userData.lastClickDate = today;
            }
            
            // التحقق من الحد اليومي
            if (userData.todayShareClicks >= dailyClickLimit) {
                showNotification('لقد وصلت للحد اليومي للنقرات على الروابط!', 'error');
                return;
            }
            
            // تحديث إحصائيات النقرات
            userData.shareClicks++;
            userData.todayShareClicks++;
            
            // منح 2 نقاط للمستخدم الذي شارك الرابط
            addPoints(pointsPerClick, 'نقرة على رابط المشاركة');
            userData.pointsFromShares += pointsPerClick;
            
            updateShareStats();
            saveUserData();
            
            showNotification(`تمت إضافة ${pointsPerClick} نقاط لنقرتك على الرابط!`, 'success');
            
            // تحديث إحصائيات المستخدم الذي قام بالإحالة
            updateReferrerStats(referralCode);
        }

        // تحديث إحصائيات المستخدم المُحيل
        function updateReferrerStats(referralCode) {
            db.collection('users').where('referralCode', '==', referralCode).get()
                .then(snapshot => {
                    if (!snapshot.empty) {
                        snapshot.forEach(doc => {
                            const referrerData = doc.data();
                            const newClicks = (referrerData.shareClicks || 0) + 1;
                            const newPointsFromShares = (referrerData.pointsFromShares || 0) + pointsPerClick;
                            
                            db.collection('users').doc(doc.id).update({
                                shareClicks: newClicks,
                                pointsFromShares: newPointsFromShares,
                                points: firebase.firestore.FieldValue.increment(pointsPerClick),
                                totalPoints: firebase.firestore.FieldValue.increment(pointsPerClick)
                            });
                        });
                    }
                })
                .catch(error => {
                    console.error('Error updating referrer stats:', error);
                });
        }

        // تحديث إحصائيات المشاركة
        function updateShareStats() {
            document.getElementById('totalShares').textContent = userData.shares;
            document.getElementById('totalClicks').textContent = userData.shareClicks;
            document.getElementById('todayClicks').textContent = `${userData.todayShareClicks}/${dailyClickLimit}`;
            document.getElementById('pointsFromShares').textContent = userData.pointsFromShares;
            document.getElementById('sidebarTodayClicks').textContent = `${userData.todayShareClicks}/${dailyClickLimit}`;
        }

        // إنشاء كود إحالة فريد
        function generateReferralCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 8; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        // تحديث رابط المشاركة برمز المستخدم الفريد
        function updateShareUrl() {
            if (currentUser && userData.referralCode) {
                const shareUrl = `${WEBSITE_URL}?ref=${userData.referralCode}`;
                document.getElementById('shareUrl').value = shareUrl;
            }
        }

        // تطبيق كود الدعوة
        async function applyPromoCode(code) {
            if (!currentUser) {
                showNotification('يجب تسجيل الدخول أولاً', 'error');
                return;
            }
            
            if (!code) {
                showNotification('يرجى إدخال كود الدعوة', 'error');
                return;
            }
            
            if (userData.usedPromoCodes.includes(code)) {
                showNotification('لقد استخدمت هذا الكود من قبل!', 'error');
                return;
            }
            
            try {
                const promoCode = await validatePromoCode(code);
                
                if (promoCode.valid) {
                    addPoints(promoCode.points, `كود دعوة: ${code}`);
                    userData.usedPromoCodes.push(code);
                    
                    document.getElementById('promoCode').value = '';
                    showNotification(`تم تطبيق الكود بنجاح! حصلت على ${promoCode.points} نقطة.`, 'success');
                } else {
                    showNotification('كود غير صالح!', 'error');
                }
            } catch (error) {
                showNotification('حدث خطأ أثناء تطبيق الكود', 'error');
            }
        }

        // التحقق من صحة كود الدعوة
        async function validatePromoCode(code) {
            const defaultCodes = {
                'WELCOME100': { points: 100, valid: true },
                'NEWUSER50': { points: 50, valid: true },
                'SPECIAL200': { points: 200, valid: true },
                'TEST123': { points: 10, valid: true }
            };
            
            return defaultCodes[code] || { valid: false, points: 0 };
        }

        // إضافة نقاط
        function addPoints(points, reason) {
            userData.points += points;
            userData.totalPoints += points;
            
            const today = new Date().toDateString();
            if (userData.lastAdDate !== today) {
                userData.todayPoints = 0;
                userData.todayAds = 0;
                userData.lastAdDate = today;
            }
            userData.todayPoints += points;
            
            const activity = {
                type: 'اكتساب',
                points: points,
                description: reason,
                timestamp: new Date()
            };
            
            userData.activity.push(activity);
            updatePointsDisplay();
            updateActivityLog();
            updateStats();
            updateUserRank();
            saveUserData();
        }

        // تحديث عرض النقاط
        function updatePointsDisplay() {
            document.getElementById('userPoints').textContent = userData.points;
            document.getElementById('sidebarTodayPoints').textContent = userData.todayPoints;
        }

        // تحديث سجل النشاط
        function updateActivityLog() {
            const activityLog = document.getElementById('activityLog');
            if (!activityLog) return;
            
            activityLog.innerHTML = '';
            
            if (!userData.activity || userData.activity.length === 0) {
                activityLog.innerHTML = '<div class="card" style="text-align: center; color: var(--gray);">لا توجد نشاطات حتى الآن</div>';
                return;
            }
            
            const recentActivities = userData.activity.slice(-10).reverse();
            
            recentActivities.forEach(activity => {
                const activityItem = document.createElement('div');
                activityItem.className = 'card';
                activityItem.style.marginBottom = '15px';
                
                const activityDate = new Date(activity.timestamp);
                const date = activityDate.toLocaleDateString('ar-EG');
                const time = activityDate.toLocaleTimeString('ar-EG', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                activityItem.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="flex: 1;">
                            <strong style="display: block; margin-bottom: 5px; color: var(--light);">${activity.description}</strong>
                            <span style="color: ${activity.points > 0 ? 'var(--success)' : 'var(--warning)'}; font-weight: bold;">
                                ${activity.points > 0 ? '+' : ''}${activity.points} نقطة
                            </span>
                        </div>
                        <div style="text-align: left; min-width: 100px;">
                            <small style="display: block; color: var(--gray);">${date}</small>
                            <small style="color: var(--gray);">${time}</small>
                        </div>
                    </div>
                `;
                
                activityLog.appendChild(activityItem);
            });
        }

        // تحديث الإحصائيات
        function updateStats() {
            document.getElementById('userPoints').textContent = userData.points;
            document.getElementById('totalPoints').textContent = userData.totalPoints;
            document.getElementById('todayPoints').textContent = userData.todayPoints;
            document.getElementById('pointsEarned').textContent = userData.totalPoints;
            document.getElementById('totalAds').textContent = userData.totalAds;
            document.getElementById('todayAds').textContent = userData.todayAds;
            document.getElementById('adsWatched').textContent = userData.adsWatched;
            
            // تحديث شريط التقدم
            const progress = (userData.points / 200) * 100;
            document.getElementById('mainProgress').style.width = `${progress}%`;
            document.getElementById('progressPercent').textContent = `${Math.round(progress)}%`;
            
            // تحديث شريط الرتب
            const rankProgress = (userData.adsWatched / 60) * 100;
            document.getElementById('rankProgress').style.width = `${Math.min(rankProgress, 100)}%`;
        }

        // تحديث رتبة المستخدم
        function updateUserRank() {
            let newRank = "مبتدئ ناشئ";
            
            if (userData.adsWatched >= 141 && userData.points >= 501) {
                newRank = "مبدع رقمي";
            } else if (userData.adsWatched >= 61 && userData.points >= 201) {
                newRank = "متوسط الاستخدام";
            }
            
            if (newRank !== userData.rank) {
                userData.rank = newRank;
                document.getElementById('currentRank').textContent = newRank;
                showNotification(`مبروك! ترقيت إلى رتبة ${newRank}`, 'success');
                updateRankCards();
            }
        }

        // تحديث كروت الرتب
        function updateRankCards() {
            const rankCards = document.querySelectorAll('.rank-card');
            rankCards.forEach(card => {
                card.classList.remove('active', 'locked');
                
                const rankName = card.querySelector('.rank-name').textContent;
                if (rankName === userData.rank) {
                    card.classList.add('active');
                } else if (
                    (userData.rank === "مبتدئ ناشئ" && rankName === "متوسط الاستخدام") ||
                    (userData.rank === "متوسط الاستخدام" && rankName === "مبدع رقمي")
                ) {
                    card.classList.add('locked');
                }
            });
        }

        // عرض الإشعارات
        function showNotification(message, type = 'success') {
            const notificationArea = document.getElementById('notificationArea');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icon = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-triangle';
            
            notification.innerHTML = `
                <i class="${icon}" style="font-size: 1.2rem;"></i>
                <span>${message}</span>
            `;
            
            notificationArea.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 4000);
        }

        // التحقق من حالة المصادقة
        function checkAuthState() {
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    loadUserData();
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('registerScreen').style.display = 'none';
                    document.getElementById('app').style.display = 'block';
                    
                    // التحقق من الإحالة المعلقة
                    const pendingReferral = localStorage.getItem('pendingReferral');
                    if (pendingReferral) {
                        handleReferralClick(pendingReferral);
                        localStorage.removeItem('pendingReferral');
                    }
                } else {
                    currentUser = null;
                    document.getElementById('loginScreen').style.display = 'flex';
                    document.getElementById('registerScreen').style.display = 'none';
                    document.getElementById('app').style.display = 'none';
                }
            });
        }

        // تسجيل الدخول
        function loginUser(email, password) {
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    showNotification('تم تسجيل الدخول بنجاح!', 'success');
                })
                .catch((error) => {
                    showNotification('خطأ في تسجيل الدخول: ' + error.message, 'error');
                });
        }

        // إنشاء حساب
        function registerUser(name, email, password) {
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    
                    // إنشاء كود إحالة فريد
                    const referralCode = generateReferralCode();
                    
                    // التحقق من وجود إحالة معلقة
                    const pendingReferral = localStorage.getItem('pendingReferral');
                    
                    // حفظ بيانات المستخدم
                    userData.name = name;
                    userData.email = email;
                    userData.referralCode = referralCode;
                    if (pendingReferral) {
                        userData.referredBy = pendingReferral;
                    }
                    
                    return db.collection('users').doc(user.uid).set({
                        name: name,
                        email: email,
                        points: 0,
                        totalPoints: 0,
                        adsWatched: 0,
                        totalAds: 0,
                        todayAds: 0,
                        todayPoints: 0,
                        shares: 0,
                        shareClicks: 0,
                        todayShareClicks: 0,
                        pointsFromShares: 0,
                        buttonClicks: 0,
                        rank: "مبتدئ ناشئ",
                        activity: [],
                        usedPromoCodes: [],
                        lastAdDate: null,
                        lastButtonClickDate: null,
                        referralCode: referralCode,
                        referredBy: userData.referredBy,
                        lastClickDate: null,
                        createdAt: new Date()
                    });
                })
                .then(() => {
                    showNotification('تم إنشاء الحساب بنجاح!', 'success');
                    saveUserData();
                    
                    // إذا كان هناك إحالة، منح النقاط للمُحيل
                    if (userData.referredBy) {
                        handleReferralClick(userData.referredBy);
                    }
                })
                .catch((error) => {
                    showNotification('خطأ في إنشاء الحساب: ' + error.message, 'error');
                });
        }

        // تحميل بيانات المستخدم
        function loadUserData() {
            db.collection('users').doc(currentUser.uid).get()
                .then((doc) => {
                    if (doc.exists) {
                        const data = doc.data();
                        userData = { ...userData, ...data };
                        
                        // تحديث الواجهة
                        document.getElementById('userName').textContent = userData.name || currentUser.email;
                        document.getElementById('currentRank').textContent = userData.rank;
                        
                        updatePointsDisplay();
                        updateActivityLog();
                        updateShareStats();
                        updateStats();
                        updateShareUrl();
                        updateRankCards();
                        
                        // التحقق من إعادة تعيين النقرات اليومية
                        const today = new Date().toDateString();
                        if (userData.lastClickDate !== today) {
                            userData.todayShareClicks = 0;
                            userData.lastClickDate = today;
                            saveUserData();
                        }
                    }
                })
                .catch((error) => {
                    console.error('Error loading user data:', error);
                });
        }

        // حفظ بيانات المستخدم
        function saveUserData() {
            if (currentUser) {
                db.collection('users').doc(currentUser.uid).set(userData, { merge: true })
                    .then(() => {
                        console.log('User data saved successfully');
                    })
                    .catch((error) => {
                        console.error('Error saving user data:', error);
                    });
            }
        }
    </script>
</body>
</html>